# {{ ansible_managed }}
frr defaults datacenter
hostname {{ inventory_hostname }}
!
{% if frr_additional_config | length > 0 %}
! Additional configuration (prefix-lists, route-maps, etc.)
{% for line in frr_additional_config %}
{{ line }}
{% endfor %}
!
{% endif %}
{% if frr_bgp_enable %}
router bgp {{ frr_bgp_asn }}
 bgp router-id {{ frr_bgp_router_id }}
{% if frr_bgp_neighbors | length > 0 %}
 !
 ! BGP Neighbors
{% for neighbor in frr_bgp_neighbors %}
 neighbor {{ neighbor.ip }} remote-as {{ neighbor.remote_as }}
{% if neighbor.description is defined %}
 neighbor {{ neighbor.ip }} description {{ neighbor.description }}
{% endif %}
{% if neighbor.update_source is defined %}
 neighbor {{ neighbor.ip }} update-source {{ neighbor.update_source }}
{% endif %}
{% if neighbor.ebgp_multihop is defined and neighbor.ebgp_multihop %}
 neighbor {{ neighbor.ip }} ebgp-multihop
{% endif %}
{% if neighbor.ttl_security_hops is defined %}
 neighbor {{ neighbor.ip }} ttl-security hops {{ neighbor.ttl_security_hops }}
{% endif %}
{% if neighbor.password is defined %}
 neighbor {{ neighbor.ip }} password {{ neighbor.password }}
{% endif %}
{% endfor %}
{% endif %}
 !
 address-family ipv4 unicast
{% if frr_bgp_redistribute_kernel is defined and frr_bgp_redistribute_kernel %}
  !
  ! Redistribute kernel routes
  redistribute kernel{% if frr_bgp_redistribute_kernel_route_map is defined %} route-map {{ frr_bgp_redistribute_kernel_route_map }}{% endif %}

{% endif %}
{% if frr_bgp_networks | length > 0 %}
  !
  ! Announced Networks
{% for network in frr_bgp_networks %}
  network {{ network.prefix }}
{% endfor %}
{% endif %}
{% if frr_bgp_neighbors | length > 0 %}
  !
  ! Neighbor activations
{% for neighbor in frr_bgp_neighbors %}
  neighbor {{ neighbor.ip }} activate
{% if neighbor.route_map_in is defined %}
  neighbor {{ neighbor.ip }} route-map {{ neighbor.route_map_in }} in
{% endif %}
{% if neighbor.route_map_out is defined %}
  neighbor {{ neighbor.ip }} route-map {{ neighbor.route_map_out }} out
{% endif %}
{% if neighbor.prefix_list_in is defined %}
  neighbor {{ neighbor.ip }} prefix-list {{ neighbor.prefix_list_in }} in
{% endif %}
{% if neighbor.prefix_list_out is defined %}
  neighbor {{ neighbor.ip }} prefix-list {{ neighbor.prefix_list_out }} out
{% endif %}
{% endfor %}
{% endif %}
 exit-address-family
exit
!
{% endif %}